<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Home</title>
  <meta name="description" content="A blog.
">

  <!-- evil icon -->

  <link rel="stylesheet" href="/assets/evil-icons.min.css">
  <script src="/assets/evil-icons.min.js"></script>

  <!-- todo: include this into main.css -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="What is Ben doing?" href="http://localhost:4000/feed.xml">

  <link rel="shortcut icon" href="/assets/favicon.ico" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-8862815-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-8862815-3');
</script>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo"><a href="/">What is Ben doing?</a></h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/archive">Posts</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <div class="home">
  <div class="post-list">

    

    <article class="post_card post">
      <header class="post_header">
        <h2 class="post_title"><a href="/programming/2018/04/12/city-problem.html">City Walk Problem</a></h2>
        <time class="post_date">12 April 2018, Thursday</time>
      </header>
      <div class="post_excerpt">
        <p>
          
          <p>
	I thought of a fun puzzle while I was at a conference in Downtown LA.

	You and I are in a city with a grid layout. All pedestrian signals alternate which direction is allowed to walk, and last exactly the same amount of time. To simplify, we are only allowed to cross one road at each intersection and we can never jaywalk. 

</p>


<br/>
<center>
<img src="/assets/img/2018/04/east.png"></img>

<img src="/assets/img/2018/04/north.png"></img>
</center>
<br/>

<p>
	We're trying to meet a friend at a restaurant two blocks north and one block east. We come to an intersection. We've got a walk signal going north, and a don't walk signal going east, with a big red timer counting down. The timer says one second. What do we do?

	Maybe you're thinking it doesn't matter?
</p>

<p>
	Like a <i>fool</i>, you go north. Your fate is sealed. At the next intersection can only go east, so you have no choice but to wait three seconds for the light to change. The intersection after that, you need to go east again. You wait an excruciating five seconds. 
</p>

<p>
	I go east. I lost one second waiting for the light to chance, but I'm not worried. As I arrive at the next intersection, I smile to myself and immediately walk whichever way the light allows, east in this case. At the next intersection, I wait a modest four seconds for the light to allow me to go north. One block later, I arrive at the intersection three precious seconds before you do. I high-five our mutual friend. You miss out.
</p>


<br/>
<center>
<img src="/assets/img/2018/04/paths.png"></img>
</center>
<br/>

<p>
	This could all have been avoided with a little math. The only signal you know about is the one you're standing at. We know that you can go north immediately, but you have to wait one second to go east so,  \( t_{north} = 0\text{ s} \) and \( t_{east} = 1\text{ s} \). We don't know anything about the other lights, other than their average behavior.
</p>

<br/>
<center>
<img src="/assets/img/2018/04/paths_uncertain.png"></img>
</center>
<br/>

<p>
	To figure out the average wait time, let's plot out the behavior. Say each walk signal lasts a time \(T\). The x-axis is the time you arrive at the light, marked with the moments when the signals change and allow a new direction to go. The y-axis is how long you must wait to go in each direction. For each of these, if you know nothing about the state of the signal, the average time you expect to wait is \( \left < t_w \right > = \frac{T}{4} \). 
</p>

<br/>
<center>
<img src="/assets/img/2018/04/wait_time.png"></img>
</center>
<br/>

<p>
	We can apply this to the intersections in question. The intersections next to the goal each have an expected time of \( \left < t_w \right > = \frac{T}{4} \). The 
</p>

           
          <a class="read-more" href="/programming/2018/04/12/city-problem.html"> »  </a>
        </p> 
      </div>
      <footer class="post_meta">


        
        <!--
        
        <a href="/category/Programming">
          <data data-icon="ei-archive"></data>
          Programming</a>
        
        -->

        <!--
        
        -->

        <!--p class="readmore">
          <a href=""><data data-icon="ei-arrow-right"></data>Read this article  </a>
        </p-->
      </footer>
      <hr/>
    </article>
    

    <article class="post_card post">
      <header class="post_header">
        <h2 class="post_title"><a href="/travel/2018/01/25/ha-giang-loop.html">The Ha Giang Loop</a></h2>
        <time class="post_date">25 January 2018, Thursday</time>
      </header>
      <div class="post_excerpt">
        <p>
          
          <p>I just got back from an amazing trip to Vietnam. <a href="http://www.declanoller.com">Declan</a> has been traveling in South East Asia for the last few months, so Liz, Phil, and I met up with him in Hanoi. There was a lot to love about this trip, but I think everyone's highlight was the Ha Giang Loop, a three day motorbiking adventure in the northern mountains of Vietnam. If you google this term, you'll find travel blogs claiming that driving the loop is the best thing you can do in Vietnam, all of South East Asia, or all the world. I'll just say, if you find yourself in northern Vietnam with a few days on your hands, you should grab a motorbike and drive the Ha Giang loop.</p>


<br/>
<center>
<img src="/assets/img/2018/01/intro.jpg"></img>
</center>
<br/>

<p>I found the prospect of illegally riding motorbikes in a very foreign country on <i>very</i> foreign roads intimidating. Declan insisted that there was nothing to worry about. This didn't comfort me much at the time, but I think he was right. The illegality seems to be a non-issue. From what we read, it is illegal to ride a motorbike in Vietnam without a Vietnamese license. However, we passed several policemen and none of them seemed to care about us. Apparently, even if they do stop you, they'll just fine you. Vietnam generally seemed to have a live-and-let-live approach to personal safety. As for the foreign roads, Google Maps and Maps.me worked well, and we seemed to have mobile internet everywhere. Driving in Vietnam looks hectic but you get used to it quickly. I had never even touched a motorbike before this, but I felt comfortable on the road very quickly.</p>

<br/>
<center>
<img src="/assets/img/2018/01/bus.jpg"></img>
</center>
<br/>

<p>From Hanoi, we grabbed an eight hour sleeper bus to Ha Giang. This was an interesting one. We had trouble finding the My Dinh bus station, and ended up being about ten minutes late. Tough luck, this was our first bus in Vietnam to leave on time. Once the mob of taxi drivers found out that we had missed our bus, one of them offered to "drive us to the bus". Huh? We were desperate and flustered and we agreed. He rushed us into his cab and took off through Hanoi. Twenty minutes later, we've cleared the city limits and we're racing north on the highway. With time to think, this plan doesn't really make sense. How are we going to find the bus? Are we meeting them at the next stop? Did the bus stop already, or will it stop when we reach it? The taxi driver is confusing to talk to, definitely not clearing any of this up. At this point, we were all wondering what kind of scam we had been wrapped up in. Then, we come around a curve and the bus is waiting for us on the side of the highway. It worked! We pulled into Ha Giang at 4 AM and crouched on a stoop until the sun came up.</p>

<center>
<iframe src="https://www.google.com/maps/embed?pb=!1m70!1m12!1m3!1d234979.19283683572!2d105.03366626397965!3d23.040293373822465!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m55!3e0!4m5!1s0x36cc79b180b4239d%3A0xb7a373a73bc23544!2sTp.+H%C3%A0+Giang%2C+Ha+Giang%2C+Vietnam!3m2!1d22.8025588!2d104.97844939999999!4m5!1s0x36cc0b114465dddf%3A0x4604a14c96bd5f73!2stt.+Tam+S%C6%A1n!3m2!1d23.0703183!2d104.9797753!4m5!1s0x36cbf16231aecb21%3A0x4739f6b88032736e!2stt.+Y%C3%AAn+Minh!3m2!1d23.1185238!2d105.1555046!4m5!1s0x36cbe6cfb1c33961%3A0x5eff1d412485f4aa!2zdHQuIMSQ4buTbmcgVsSDbg!3m2!1d23.278147099999998!2d105.3627336!4m5!1s0x36cbe81fbd0477f3%3A0xb8b865a695ad5a84!2zdHQuIE3DqG8gVuG6oWM!3m2!1d23.1556005!2d105.41266519999999!4m5!1s0x36cbed78efd1f3b9%3A0x1d19ab4048e497a!2zTeG6rXUgRHXhu4c!3m2!1d23.0685118!2d105.2370339!4m5!1s0x36cbf16231aecb21%3A0x4739f6b88032736e!2stt.+Y%C3%AAn+Minh%2C+Y%C3%AAn+Minh+District%2C+Ha+Giang%2C+Vietnam!3m2!1d23.1185238!2d105.1555046!4m5!1s0x36cc0b114465dddf%3A0x4604a14c96bd5f73!2zdHQuIFRhbSBTxqFuLCBRdeG6o24gQuG6oSBEaXN0cmljdCwgSGEgR2lhbmcsIFZpZXRuYW0!3m2!1d23.0703183!2d104.9797753!4m5!1s0x36cc79b180b4239d%3A0xb7a373a73bc23544!2sTp.+H%C3%A0+Giang%2C+Ha+Giang%2C+Vietnam!3m2!1d22.8025588!2d104.97844939999999!5e0!3m2!1sen!2sus!4v1516985967095" width="600" height="450" frameborder="0" style="border:0" allowfullscreen></iframe>
</center>

<p>In Ha Giang, it was no problem to rent bikes. We picked up four of them for about two million dong, something like $100. We fueled up and headed north for Tam Son. Leaving Ha Giang, we passed through a long valley. The road was flat, but we could see mountains start to rise on either side of us. </p>

<br/>
<center>
<img src="/assets/img/2018/01/leaving_ha_giang.jpg"></img>
</center>
<br/>

<p>Pretty soon, we were ascending steeply and looking back down at the valley floor.</p>

<br/>
<center>
<img src="/assets/img/2018/01/valley_floor.jpg"></img>
</center>
<br/>

<p>At the top of this climb was the Dong Van Karst Plateau. We stopped for some tea and wondered if we were dressed warmly enough for the elevation. We were. We all had wind breakers and gloves. This turned out to be the coldest part of our ride. We descended into Tam Son for lunch, and continued north toward Yen Minh.</p>

<br/>
<center>
<img src="/assets/img/2018/01/tam_son_yen_minh.jpg"></img>
</center>
<br/>

<p>We found a great hostel in Yen Minh and stayed for the night. If you're looking for a place to stay, check out the A2 Coffee an Hostel.

<br/>
<center>
<img src="/assets/img/2018/01/hostel_2.jpg"></img>
</center>
<br/>

<p>Day two was spectacular. We left the hostel early, knowing we had a lot of riding to do. Our plan was to ride north to Dong Van, then south to Meo Vac, then back to Yen Minh via Mau Due. </p>


<br/>
<center>
<img src="/assets/img/2018/01/ma_pi_leng_0.jpg"></img>
</center>
<br/>

<p>We stopped in Dong Van for lunch. Phil wasn't feeling too hot and, unrelatedly, we saw a cow being ripped apart in the street. </p>


<br/>
<center>
<img src="/assets/img/2018/01/cow.jpg"></img>
</center>
<br/>

<p>Between Dong Van and Meo Vac is the Ma Pi Leng pass. This is the most spectacular part of the loop. Don't skip it.</p>


<br/>
<center>
<img src="/assets/img/2018/01/ma_pi_leng_1.jpg"></img>
<img src="/assets/img/2018/01/ma_pi_leng_2.jpg"></img>
</center>
<br/>

<p>You get it.</p>

<br/>
<center>
<img src="/assets/img/2018/01/ma_pi_leng_3.jpg"></img>
<img src="/assets/img/2018/01/ma_pi_leng_4.jpg"></img>
</center>
<br/>

<p>After about eight hours of driving, we made it back to Yen Minh before the sun went down. Phil was feeling a bit better</p>

<br/>
<center>
<img src="/assets/img/2018/01/hostel.jpg"></img>
</center>
<br/>

<p>The next day we back tracked to Ha Giang. It was sad leaving. </p>


<br/>
<center>
<img src="/assets/img/2018/01/leaving.jpg"></img>
</center>
<br/>

<p>Back in Ha Giang, we used our remaining daylight to climb to the shrine at the top of the hill. Instead of asking for a few thousand dong to visit, they asked us to carry bricks to a construction site at the top! </p>

<br/>
<center>
<img src="/assets/img/2018/01/hill.jpg"></img>
<img src="/assets/img/2018/01/bricks.jpg"></img>
</center>
<br/>

<p>We returned our bikes and headed to the bus station where we saw a very sad pig and caught our bus uneventfully. A great trip!</p>

<br/>
<center>
<img src="/assets/img/2018/01/pig.jpg"></img>
</center>
<br/>
           
          <a class="read-more" href="/travel/2018/01/25/ha-giang-loop.html"> »  </a>
        </p> 
      </div>
      <footer class="post_meta">


        
        <!--
        
        <a href="/category/Travel">
          <data data-icon="ei-archive"></data>
          Travel</a>
        
        -->

        <!--
        
        -->

        <!--p class="readmore">
          <a href=""><data data-icon="ei-arrow-right"></data>Read this article  </a>
        </p-->
      </footer>
      <hr/>
    </article>
    

    <article class="post_card post">
      <header class="post_header">
        <h2 class="post_title"><a href="/woodworking/2017/12/27/bench.html">Bench</a></h2>
        <time class="post_date">27 December 2017, Wednesday</time>
      </header>
      <div class="post_excerpt">
        <p>
          
          <p>Matt and I made a fancy new bench out of red oak. In case you can't tell it has subtly curved legs and stretchers, with mortice and tenon joints connecting them. The legs attach to the top with some neato through-tenons, exposing the end grain of the wood.</p>

<br/>
<center>
<img src="/assets/img/2017/12/final.jpg"></img>
</center>
<br/>


<p>The design was based on images from this <a href="https://www.thewoodwhisperer.com/viewer-projects/cousin-jims-entry-bench/">Wood Wisperer post</a>. Below are some adapted plans, with the dimensions we ended up using.</p>
<br/>
<center>
<img src="/assets/img/2017/12/plan.png"></img>
</center>

<p>Here are some plans of the individual pieces: the seat, the two long stretchers, the two short stretchers, and the four legs. All the parts except for the seat have gentle curves cut into one edge.</p>

<center>
<img src="/assets/img/2017/12/plan_2.png"></img>
</center>
<br/>

<p>We started by making the seat. We edge joined two 40" pieces of 2x8" red oak. We read that you need a jointer to make edge joining work. It would probably help, but we just glued together the factory edges from the lumber yard. There was a visable glue seam in some places, but it was good enough for us.</p>

<p>Speaking of the lumber yard, we went to <a href="http://www.lsweetlumber.com/">L. Sweet Lumber</a> in Providence. They were helpful and the wood was beautiful.</p>

<center>
<img src="/assets/img/2017/12/edge.jpg"></img>
</center>
<br/>

<p>Next, we cut the legs and stretchers to length. The legs were made from 2x6" and the stretchers from 1x4".</p>

<center>
<img src="/assets/img/2017/12/cut_2.jpg"></img>
</center>
<br/>

<p>Next, we cut the mortices. We decided to go with uniform 1/8" shoulders for all of our tenons. This left us with ~1/2" wide mortices for the stretchers and ~1 1/2" for the legs. We used Phil's drill press with some forstner bits to remove most of the wood, then finished the mortices with the chisels.</p>

<center>
<img src="/assets/img/2017/12/mortices.jpg"></img>
</center>
<br/>

<p>This was time consuming and difficult, especially for the larger mortices on the seat. These were for through-tenons, so the result would be on display on the seat of the bench. We made some gnarly edges in some places.</p>

<center>
<img src="/assets/img/2017/12/seat_mortices.jpg"></img>
</center>
<br/>

<p>Next, the tenons. We did this on the table saw, using a dado. We threw together a table saw sled for this part, and it was very helpful. I can't believe we didn't have a sled before this. We put together a 1/2" dado stack and clamped a stop for the tenon length. We ran the ends of the stretchers and legs over the dado for a few passes, until we reached the stop. The length was 3/4" for the stretcher tenons and just over 1 3/4" for the legs, so that they would barely emerge from the top of the seat. After sanding them to fit, they were looking <i>pretty</i> handsome. </p>

<center>
<img src="/assets/img/2017/12/tenon_close.jpg"></img>
</center>
<br/>

<p>We weren't exactly sure how we would cut the curves into the stretchers and legs. We marked the curves very approximately according to the plan. We traced the small stretcher curves with a 24" drum head. Luckily it had exactly the right radius for our design. For the long stretchers and legs, we didn't have any enormous circles on hand so we just bent a thin piece of wood and clamped it in place.</p>

<p>We didn't have access to a band saw, and we were worried that we'd mess it up with the jig saw. There was no other option, though. The curves looked only a little horrible immediately after cutting, and way better after some fine tuning with the palm sander. Now we had all the pieces ready.</p>

<p>Gluing everything together was almost a disaster. We carefully fit every tenon to its matching mortice with chisels and sand paper, but when we started gluing we realized we had done it wrong and commited to an impossible orientation. We pressed ahead, hoping everything would fit, but the glue started setting and some of the tenons felt stuck half way in. I thought we were doomed. There were some moments of "Oh god, what do we...?! Just hit it! Is it fitting? Just hit it keep hitting it!". After five minutes of terror and dozens of strikes with the mallet, the bench made it together. Somehow, it was square everywhere.</p>

<p>We filled the shameful gaps between the mortices and tenon ends on the top of the seat with a mixture of saw dust and wood glue. This seemed to work.</p>

<center>
<img src="/assets/img/2017/12/glue.jpg"></img>
</center>
<br/>

<p>The next morning, we removed the clamps, and sanded away all the glue. On the seat, we sanded almost 1/8" of the ends of the tenons to make them flush. We worked our way to 400 grit on every surface. We tried some weird fine sanding disks called <a href="https://www.homedepot.com/p/Diablo-5-in-120-Grit-SandNet-Disc-with-Free-Application-Pad-10-Pack-DND050120H10I/301439866">SandNet</a> from the Home Depot, because they looked fun. It's some kind mesh material made from ancient elven fibers. The pack says it lasts longer because you can wash the sawdust out of it. Instead, they seemed to get ripped up immediately by the sander. I don't know. </p>

<center>
<img src="/assets/img/2017/12/sand.jpg"></img>
</center>
<br/>

<p>Finally, we applied two coats of finishing wax.</p>

<center>
<img src="/assets/img/2017/12/wax.jpg"></img>
</center>
<br/>

<p>Here's the finished product. It turned out to be very heavy and sturdy. Hopefully no one ever has to move it.</p>

<center>
<img src="/assets/img/2017/12/done.jpg"></img>
</center>
<br/>

           
          <a class="read-more" href="/woodworking/2017/12/27/bench.html"> »  </a>
        </p> 
      </div>
      <footer class="post_meta">


        
        <!--
        
        <a href="/category/Woodworking">
          <data data-icon="ei-archive"></data>
          Woodworking</a>
        
        -->

        <!--
        
        -->

        <!--p class="readmore">
          <a href=""><data data-icon="ei-arrow-right"></data>Read this article  </a>
        </p-->
      </footer>
      <hr/>
    </article>
    

    <article class="post_card post">
      <header class="post_header">
        <h2 class="post_title"><a href="/programming/art/2017/08/24/lewitt.html">Programmatic Sol LeWitt Wall Drawing</a></h2>
        <time class="post_date">24 August 2017, Thursday</time>
      </header>
      <div class="post_excerpt">
        <p>
          
          <p>I visited MASS MoCA with some friends recently. There was a whole building there filled with the work of Sol LeWitt, a contemporary artist famous for minimalist geometric art. We spent a while looking at <i>Wall Drawing #797</i>.</p>

<br/>
<center>
<img src="/assets/img/2017/08/lewitt_797.jpg" width=90%></img>
<br/>
<caption>Helen Harrison</caption>
</center>
<br/>

<p>This drawing was made in an interesting way. One person drew a starting wavy line at the top. Then artists took turns following the bottom of the line with another line. This was repeated for the whole wall. The result has some complicated behavior. Concave parts produced ridges propagating downward and combining into larger ridges. It reminded us of caustic shapes produced by the complex surface of disturbed water. Phil pointed out that the connection with waves isn't an accident, since this procedure effectively applies Huygens' Principle. <a href="http://www.philipzucker.com/elm-eikonal-sol-lewitt/">He blogged about this too</a>, but my post is better.</p>

<p>We all thought it would be cool to reproduce this idea in a computer. I found a way to do it with a few lines of Mathematica. </p>

<center>
<img src="/assets/img/2017/08/lewitt.png" width=90%></img>
</center>
<br/>


<p>Not a perfect match, but it has most of the features we noticed. The heart of it is the overloaded function, <code>requiredY</code>. The points that make up the lines are confined to discrete positiosn in <code>x</code>. With two arguments, it finds the new <code>y</code> value required to put a new point at in the column at index <code>i</code> based on being a distance <code>r</code> from the last point in the row at index <code>j</code>. With one argument, it finds the minimum <code>y</code> required by all other rows. Maybe that makes sense. The rest of the code is just defining the starting curve, repeatedly applying the function that generates a new line, and displaying the results.</p>

<figure class="highlight"><pre><code class="language-mathematica" data-lang="mathematica">xs = Range[200];
ys = 10 + 5 (Sin[xs/10.] + Sin[xs/6.] + Sin[xs/16.]) +
   Last /@ Normal[
      RandomFunction[WienerProcess[0, .75], {0, 199, 1}]][[1]];
next[xs_, ys_, r_] := Module[{requiredY, newYs},
  requiredY[i_, j_] := ys[[j]] - Sqrt[r^2 - Abs[i - j]^2];
  requiredY[i_] :=
   Min[requiredY[i, #] &amp; /@ Range[Max[i - r, 1], Min[i + r, 200]]];
  newYs = requiredY /@ xs;
  newYs
  ]
ListPlot[NestList[next[xs, #, 2] &amp;, ys, 50], Joined -&gt; True,
 Axes -&gt; False, PlotStyle -&gt; {Thickness[0.005]}]</code></pre></figure>

I stumbled on some other neat looking results by accident too.

<center>
<img src="/assets/img/2017/08/lewitt_mistake_1.png" width=90%></img>
</center>

<center>
<img src="/assets/img/2017/08/lewitt_mistake_2.png" width=90%></img>
</center>

           
          <a class="read-more" href="/programming/art/2017/08/24/lewitt.html"> »  </a>
        </p> 
      </div>
      <footer class="post_meta">


        
        <!--
        
        <a href="/category/Programming">
          <data data-icon="ei-archive"></data>
          Programming</a>
        
        <a href="/category/Art">
          <data data-icon="ei-archive"></data>
          Art</a>
        
        -->

        <!--
        
        -->

        <!--p class="readmore">
          <a href=""><data data-icon="ei-arrow-right"></data>Read this article  </a>
        </p-->
      </footer>
      <hr/>
    </article>
    

    <article class="post_card post">
      <header class="post_header">
        <h2 class="post_title"><a href="/programming/2017/08/23/Q-learning.html">Q Learning Maze Game</a></h2>
        <time class="post_date">23 August 2017, Wednesday</time>
      </header>
      <div class="post_excerpt">
        <p>
          
          <p>I've been learning about reinforcement learning. The simplest version I've heard of is called Q learning. The key to this method is maintaing a Q matrix, which stores information about the quality each state-action pair. Once trained, a player can simply look up their state and take the action with the highest value.</p>

<p>The goal is obviously to train this Q matrix to accurately reflect the game. This can be done by taking moves and updating Q each time in the following way:</p>

<center>
<img src="/assets/img/2017/08/Q_update.svg" width=90%></img>
</center>

<p>As you can see below, when my QLearner is training, it takes random moves every time. I think the more common way to do it is to sometimes take random moves and sometimes take moves according to the current version of Q. That kind of weights the learner toward moves that <i>seem</i> better. It doesn't matter in this case, though. The maze problem is so easy that anything would work.</p>

<p>Here, the reward is simply zero unless the player reaches the goal. At first I set the discount factor, gamma, to be 1. This did not work. Since the random player will always eventually finish the maze, this resulted in every square eventually getting a value of 1. The discount factor means that faster routes to the goal are favored.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="k">class</span> <span class="nc">Maze</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">player</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">block</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">empty</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Tile</span><span class="o">.</span><span class="n">goal</span>
        <span class="bp">self</span><span class="o">.</span><span class="nb">map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">],</span>
            <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">],</span>
            <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">],</span>
            <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
            <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">returnStr</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerPos</span><span class="p">:</span>
                    <span class="n">returnStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Tile</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">returnStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">returnStr</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        <span class="k">return</span> <span class="n">returnStr</span>
    <span class="k">def</span> <span class="nf">tileAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="nb">map</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">isValidPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playerPos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gameWon</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
        <span class="n">movePos</span> <span class="o">=</span> <span class="n">addTuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playerPos</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isValidPos</span><span class="p">(</span><span class="n">movePos</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAt</span><span class="p">(</span><span class="n">movePos</span><span class="p">)</span> <span class="o">==</span> <span class="n">Tile</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playerPos</span> <span class="o">=</span> <span class="n">movePos</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tileAt</span><span class="p">(</span><span class="n">movePos</span><span class="p">)</span> <span class="o">==</span> <span class="n">Tile</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playerPos</span> <span class="o">=</span> <span class="n">movePos</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gameWon</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">QLearner</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maze</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maze</span> <span class="o">=</span> <span class="n">maze</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">gameWon</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateQ</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateQ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">playerPos</span>
        <span class="n">moveDir</span> <span class="o">=</span> <span class="n">Dir</span><span class="o">.</span><span class="n">moveOptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">moveDir</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maze</span><span class="o">.</span><span class="n">playerPos</span>

        <span class="n">maxQ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">reward</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">maxQ</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
    <span class="k">def</span> <span class="nf">getBestMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="n">bestMove</span> <span class="o">=</span> <span class="n">Dir</span><span class="o">.</span><span class="n">moveOptions</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]])]</span>
        <span class="k">return</span> <span class="n">bestMove</span>


<span class="k">def</span> <span class="nf">addTuple</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">),</span> <span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">)):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">b1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dir</span><span class="p">:</span>
    <span class="n">UP</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DOWN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">LEFT</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">RIGHT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">moveOptions</span> <span class="o">=</span> <span class="p">[</span><span class="n">UP</span><span class="p">,</span> <span class="n">RIGHT</span><span class="p">,</span> <span class="n">DOWN</span><span class="p">,</span> <span class="n">LEFT</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Tile</span><span class="p">:</span>
    <span class="n">player</span> <span class="o">=</span> <span class="s">'p'</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="s">'g'</span>
    <span class="n">block</span> <span class="o">=</span> <span class="s">'X'</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="s">' '</span>

<span class="n">maze</span> <span class="o">=</span> <span class="n">Maze</span><span class="p">()</span>
<span class="n">learner</span> <span class="o">=</span> <span class="n">QLearner</span><span class="p">(</span><span class="n">maze</span><span class="p">)</span>
<span class="n">learner</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="k">print</span> <span class="n">learner</span><span class="o">.</span><span class="n">Q</span>

<span class="n">maze</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">while</span> <span class="n">maze</span><span class="o">.</span><span class="n">gameWon</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
    <span class="n">maze</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">getBestMove</span><span class="p">(</span><span class="n">maze</span><span class="o">.</span><span class="n">playerPos</span><span class="p">))</span>
    <span class="k">print</span> <span class="n">maze</span></code></pre></figure>

           
          <a class="read-more" href="/programming/2017/08/23/Q-learning.html"> »  </a>
        </p> 
      </div>
      <footer class="post_meta">


        
        <!--
        
        <a href="/category/Programming">
          <data data-icon="ei-archive"></data>
          Programming</a>
        
        -->

        <!--
        
        -->

        <!--p class="readmore">
          <a href=""><data data-icon="ei-arrow-right"></data>Read this article  </a>
        </p-->
      </footer>
      <hr/>
    </article>
    

    <div class="pagination older-post"><a href="./archive"><data data-icon="ei-arrow-right"></data> Archive  </a></div>
  </div>
</div>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        Theme <a href="https://github.com/wild-flame/jekyll-simple"> Simple </a> by <a href="http://wildflame.me">wildflame</a>
        © 2016 
        Powered by <a href="https://github.com/jekyll/jekyll">jekyll</a>
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/ishmandoo"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a>

        
        
        <a href="https://twitter.com/ishmandoo"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span></a>

        
      </section>
    </div>
  </div>
</footer>
 
    </div>
  </body>
</html>
